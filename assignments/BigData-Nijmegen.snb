{"metadata":{"name":"Nijmegen","user_save_timestamp":"1970-01-01T00:00:00.000Z","auto_save_timestamp":"1970-01-01T00:00:00.000Z","language_info":{"name":"scala","file_extension":"scala","codemirror_mode":"text/x-scala"},"trusted":true,"customLocalRepo":null,"customRepos":null,"customDeps":null,"customImports":null,"customArgs":null,"customSparkConf":null},"cells":[{"metadata":{},"cell_type":"markdown","source":"# Nijmegen Open Data\n\nSpark Notebook to help you analyze data sets provided by Nijmegen's city council."},{"metadata":{},"cell_type":"markdown","source":"## Nijmegen data\n\nThe city of Nijmegen provides a variety of resources as open data at\n[nijmegen.nl/opendata](http://www.nijmegen.nl/opendata/).\n\nOur goal is to analyze these together - to investigate if we can say anything about the relation between population statistics in areas of the city and the activities that are organized there.\n\nSpecifically, we will integrate the following three data sets:\n- `vBoaEvents_all.csv` and `vBoaEventsLoc_all.csv` for events and their locations\n- `BAG_ADRES.csv` for streetnames and their quarters\n- `opendata_stadsgetallen.accdb` for a variety of statistics about the population\n\nThe notebook contains code to get you started in the analysis. In your blog, include the answers to the suggested questions starting with _**Q:**_. Feel free to work through the whole notebook before giving answers, but do discuss each of the questions in the assignment blog."},{"metadata":{},"cell_type":"markdown","source":"### Addresses and Quarters\n\nQuarters are listed in the basic address information from the so-called BAG (_basisadministratie adressen en gebouwen_, i.e., records of addresses and buildings)."},{"metadata":{},"cell_type":"markdown","source":"Just using split may work in some cases, but as soon as quoted values contain commas, we would get in trouble.\n\nLet us instead parse the CSV Files using a widely used open source parser, see http://opencsv.sourceforge.net/"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import au.com.bytecode.opencsv.CSVParser","outputs":[{"name":"stdout","output_type":"stream","text":"import au.com.bytecode.opencsv.CSVParser\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":1}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagdata = sc.textFile(\"/data/BAG_ADRES.csv\").cache()","outputs":[{"name":"stdout","output_type":"stream","text":"bagdata: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at textFile at <console>:46\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[1] at textFile at &lt;console&gt;:46"},"output_type":"execute_result","execution_count":2}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"bagdata.take(2)","outputs":[{"name":"stdout","output_type":"stream","text":"res1: Array[String] = Array(ACTCODE,ADRES_ID,ADR_ADRESNR,HUISLETTER,HUISNUMMER,HUISNUMMERTOEVOEGING,OPENBARERUIMTE_ID,POSTK_A,POSTK_N,STADSDEEL,STATUS,STRAAT,STRAAT_OFF,STRAAT_OFF_D,VOLGNR,WIJKCODE,WIJK_OMS,WOONPLAATS,X_COORD,Y_COORD, A,0268200000097065,,,9,A25,0268300000001013,AS,6522,Nijmegen-Oost,Naamgeving uitgegeven,Dr. Claas Noorduijnstraat,Dr. Claas Noorduijnstr,Dr. Claas Noorduijnstr,2,05,Hunnerberg,Nijmegen,\"188670,929999999990000\",\"428403,169999999980000\")\n"},{"metadata":{},"data":{"text/html":"<div class=\"container-fluid\"><div><div class=\"col-md-12\"><div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon2e2fc63470b893ce13c26aff0654a92d&quot;,&quot;dataInit&quot;:[{&quot;string value&quot;:&quot;ACTCODE,ADRES_ID,ADR_ADRESNR,HUISLETTER,HUISNUMMER,HUISNUMMERTOEVOEGING,OPENBARERUIMTE_ID,POSTK_A,POSTK_N,STADSDEEL,STATUS,STRAAT,STRAAT_OFF,STRAAT_OFF_D,VOLGNR,WIJKCODE,WIJK_OMS,WOONPLAATS,X_COORD,Y_COORD&quot;},{&quot;string value&quot;:&quot;A,0268200000097065,,,9,A25,0268300000001013,AS,6522,Nijmegen-Oost,Naamgeving uitgegeven,Dr. Claas Noorduijnstraat,Dr. Claas Noorduijnstr,Dr. Claas Noorduijnstr,2,05,Hunnerberg,Nijmegen,\\&quot;188670,929999999990000\\&quot;,\\&quot;428403,169999999980000\\&quot;&quot;}],&quot;genId&quot;:&quot;1369016276&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"string value\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon56120f3326310b01d85cffdf27485a1a\">\n      Max Points\n    </label><input id=\"input-anon56120f3326310b01d85cffdf27485a1a\" type=\"number\" name=\"input-anon56120f3326310b01d85cffdf27485a1a\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon56120f3326310b01d85cffdf27485a1a\" data-this=\"{&quot;valueId&quot;:&quot;anon56120f3326310b01d85cffdf27485a1a&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon678c01dd7c2b459512d6915bd3c9eac2&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf020c344b6f69ca8fac6bc1d6535827e&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div></div></div></div>"},"output_type":"execute_result","execution_count":3}]},{"metadata":{},"cell_type":"markdown","source":"Quite common in practice: _the first line of the data shared as CSV contains the schema information_.\n\nWe write a utility function to ignore the first element of the first RDD partition; and, while at it, also code a few lines of Scala to help process the first line and access to fields by their names instead of numbers."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagHeader = bagdata.take(1).mkString.split(\",\").zipWithIndex","outputs":[{"name":"stdout","output_type":"stream","text":"bagHeader: Array[(String, Int)] = Array((ACTCODE,0), (ADRES_ID,1), (ADR_ADRESNR,2), (HUISLETTER,3), (HUISNUMMER,4), (HUISNUMMERTOEVOEGING,5), (OPENBARERUIMTE_ID,6), (POSTK_A,7), (POSTK_N,8), (STADSDEEL,9), (STATUS,10), (STRAAT,11), (STRAAT_OFF,12), (STRAAT_OFF_D,13), (VOLGNR,14), (WIJKCODE,15), (WIJK_OMS,16), (WOONPLAATS,17), (X_COORD,18), (Y_COORD,19))\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon204a3afadf027c9a0485c2aa277abb18&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;841925361&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon9c24b14dbd6dd148b7c26d87583419de\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anon9c24b14dbd6dd148b7c26d87583419de\" type=\"number\" name=\"input-anon9c24b14dbd6dd148b7c26d87583419de\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon9c24b14dbd6dd148b7c26d87583419de\" data-this=\"{&quot;valueId&quot;:&quot;anon9c24b14dbd6dd148b7c26d87583419de&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul841925361\"><li>\n                <a href=\"#tab841925361-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab841925361-1\"><i class=\"fa fa-bar-chart\"/></a>\n              </li><li>\n                <a href=\"#tab841925361-2\"><i class=\"fa fa-pie-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab841925361\"><div class=\"tab-pane\" id=\"tab841925361-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon54d4c31faa4d659e47886fedd0496bb9&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;493331188&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anond40a40334abfeff88900d1656c840071\">\n      Max Points\n    </label><input id=\"input-anond40a40334abfeff88900d1656c840071\" type=\"number\" name=\"input-anond40a40334abfeff88900d1656c840071\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anond40a40334abfeff88900d1656c840071\" data-this=\"{&quot;valueId&quot;:&quot;anond40a40334abfeff88900d1656c840071&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf9e035c99bf9a4ea7b0be0856fb2e889&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonc5624e6f76bae5c5df60dfde67f2a774&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab841925361-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon9b1ba527aeef1398262648d1afeaa59b&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;110258526&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon24f887cda71efcca5129c9a5c130fd1b\">\n      Max Points\n    </label><input id=\"input-anon24f887cda71efcca5129c9a5c130fd1b\" type=\"number\" name=\"input-anon24f887cda71efcca5129c9a5c130fd1b\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon24f887cda71efcca5129c9a5c130fd1b\" data-this=\"{&quot;valueId&quot;:&quot;anon24f887cda71efcca5129c9a5c130fd1b&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf5df1b2c5eda7086f073156549c5eaf9&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon96d41e9dbaaa1ecbc1a776e983d33de1&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab841925361-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon881ada969499da497381daed9ed63722&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1722175792&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pieChart'], \n      function(playground, _magicpieChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpieChart,\n    \"o\": {\"series\":\"_1\",\"p\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anondd353c6e40cf4be36ff51cf585fecb3c\">\n      Max Points\n    </label><input id=\"input-anondd353c6e40cf4be36ff51cf585fecb3c\" type=\"number\" name=\"input-anondd353c6e40cf4be36ff51cf585fecb3c\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anondd353c6e40cf4be36ff51cf585fecb3c\" data-this=\"{&quot;valueId&quot;:&quot;anondd353c6e40cf4be36ff51cf585fecb3c&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon3a875e6f802736d3a6db6eb2dd46516e&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon1266e56accb7f568cb0f9f7270f5c3a8&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":4}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"def fno(hdr: Array[(String,Int)], fnm: String):Int = {\n  hdr.find(_._1.startsWith(fnm)).get._2\n}\n\nval fnos = Array( fno(bagHeader, \"STRAAT_OFF\"), fno(bagHeader, \"WIJK_\"), fno(bagHeader, \"X_\"), fno( bagHeader, \"Y_\"))","outputs":[{"name":"stdout","output_type":"stream","text":"fno: (hdr: Array[(String, Int)], fnm: String)Int\nfnos: Array[Int] = Array(12, 16, 18, 19)\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon524b4e7b75a6f8bb9a4866c72ead1fe9&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1654104160&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon9fc78d313b5c36010ef2f33b0cf29719\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anon9fc78d313b5c36010ef2f33b0cf29719\" type=\"number\" name=\"input-anon9fc78d313b5c36010ef2f33b0cf29719\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon9fc78d313b5c36010ef2f33b0cf29719\" data-this=\"{&quot;valueId&quot;:&quot;anon9fc78d313b5c36010ef2f33b0cf29719&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul1654104160\"><li>\n                <a href=\"#tab1654104160-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab1654104160-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n              </li><li>\n                <a href=\"#tab1654104160-2\"><i class=\"fa fa-line-chart\"/></a>\n              </li><li>\n                <a href=\"#tab1654104160-3\"><i class=\"fa fa-bar-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab1654104160\"><div class=\"tab-pane\" id=\"tab1654104160-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon0770e2b4fb32aad98d21374a3754589b&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1243755675&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonaffa46caeb87d1855a204bce7bfde19a\">\n      Max Points\n    </label><input id=\"input-anonaffa46caeb87d1855a204bce7bfde19a\" type=\"number\" name=\"input-anonaffa46caeb87d1855a204bce7bfde19a\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonaffa46caeb87d1855a204bce7bfde19a\" data-this=\"{&quot;valueId&quot;:&quot;anonaffa46caeb87d1855a204bce7bfde19a&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon584231f2ccd463556fb76c073659c4c1&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anond7f6918a31d1762a74979ce95d5481d3&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab1654104160-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon8c73f78b82bc9216b89baf8e6fb4d6a0&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;962616651&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon80762c5addd1fe3184868c301ce83963\">\n      Max Points\n    </label><input id=\"input-anon80762c5addd1fe3184868c301ce83963\" type=\"number\" name=\"input-anon80762c5addd1fe3184868c301ce83963\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon80762c5addd1fe3184868c301ce83963\" data-this=\"{&quot;valueId&quot;:&quot;anon80762c5addd1fe3184868c301ce83963&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon47d4b2c12bb35b6619719e75b5f78124&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon72b0d93b7bd698121c24df01bf6533cf&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab1654104160-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anone3fe1ee18540de7c4e7559db220e22cc&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1434536458&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anone1ed9487e962f440fe62c3540d3b6ad7\">\n      Max Points\n    </label><input id=\"input-anone1ed9487e962f440fe62c3540d3b6ad7\" type=\"number\" name=\"input-anone1ed9487e962f440fe62c3540d3b6ad7\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anone1ed9487e962f440fe62c3540d3b6ad7\" data-this=\"{&quot;valueId&quot;:&quot;anone1ed9487e962f440fe62c3540d3b6ad7&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon6ba10c0a647a7b5b5890c59e40d1f2e0&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon5efe74f9897ca1a8e3b2564df73f64ee&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab1654104160-3\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon3e5882212b79fc4647af2d2d33022b14&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;554458773&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anona9c58c5797d8f9f535112a3036c894d6\">\n      Max Points\n    </label><input id=\"input-anona9c58c5797d8f9f535112a3036c894d6\" type=\"number\" name=\"input-anona9c58c5797d8f9f535112a3036c894d6\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anona9c58c5797d8f9f535112a3036c894d6\" data-this=\"{&quot;valueId&quot;:&quot;anona9c58c5797d8f9f535112a3036c894d6&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon7f260eb7265387a37da563cc4046acbd&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonc36350f94ff9f57e10c3db3241ed5920&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":5}]},{"metadata":{},"cell_type":"markdown","source":"A scala function that skips the first record of the first partition, using the `mapPartitionsWithIndex` operator."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"def dropHeader(data: RDD[String]): RDD[String] = {\n         data.mapPartitionsWithIndex((idx, lines) => {\n           if (idx == 0) {\n             lines.drop(1)\n           }\n           lines\n         })\n       }","outputs":[{"name":"stdout","output_type":"stream","text":"dropHeader: (data: org.apache.spark.rdd.RDD[String])org.apache.spark.rdd.RDD[String]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":6}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagNoHeader: RDD[String] = dropHeader(bagdata).cache()","outputs":[{"name":"stdout","output_type":"stream","text":"bagNoHeader: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[2] at mapPartitionsWithIndex at <console>:47\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[2] at mapPartitionsWithIndex at &lt;console&gt;:47"},"output_type":"execute_result","execution_count":7}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addresses = bagNoHeader.mapPartitions(lines => {\n         val parser = new CSVParser(',')\n         lines.map(line => {\n           val fields = parser.parseLine(line)\n           fnos.map(fields(_))\n         })\n       }).cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addresses: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[3] at mapPartitions at <console>:52\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[3] at mapPartitions at &lt;console&gt;:52"},"output_type":"execute_result","execution_count":8}]},{"metadata":{},"cell_type":"markdown","source":"### Analysis using RDDs"},{"metadata":{},"cell_type":"markdown","source":"Using the `addresses` RDD, we can easily summarize statistics, e.g., to determine the number of addresses, or the number of addresses listed per quarter."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addresses.count","outputs":[{"name":"stdout","output_type":"stream","text":"res2: Long = 96867\n"},{"metadata":{},"data":{"text/html":"96867"},"output_type":"execute_result","execution_count":9}]},{"metadata":{},"cell_type":"markdown","source":"**Q:** _List the quarters with the largest number of addresses._"},{"metadata":{},"cell_type":"markdown","source":"### Analysis using the Data Frame API"},{"metadata":{},"cell_type":"markdown","source":"We can also define a Data Frame for the data, which simplifies the processing of more complex queries.\n\nFirst the preamble, importing some necessary classes and creating a `sqlContext`."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val sqlContext = new org.apache.spark.sql.SQLContext(sc)\n\n// Special construct to allow implicit conversion of RDDs to DataFrames:\nimport sqlContext.implicits._\n\n// Additional imports needed:\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions._","outputs":[{"name":"stdout","output_type":"stream","text":"sqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@1ea7caa0\nimport sqlContext.implicits._\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions._\n"},{"metadata":{},"data":{"text/html":"org.apache.spark.sql.SQLContext$implicits$@6f15253e"},"output_type":"execute_result","execution_count":12}]},{"metadata":{},"cell_type":"markdown","source":"The Data Frame API supports a more structured interface to data by defining a `case class` to represent the data. \n\n**NOTE:** _The specific versions of Scala and Spark that we use unfortunately has a bug, that we circumvent with the\nadditional line below - that can be removed in future versions of the Notebook._"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"case class Addr(street:String, quarter:String, x:Float, y:Float)\norg.apache.spark.sql.catalyst.encoders.OuterScopes.addOuterScope(this)","outputs":[{"name":"stdout","output_type":"stream","text":"defined class Addr\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":13}]},{"metadata":{},"cell_type":"markdown","source":"Actually, parsing the X and Y coordinates is a little messy: the data contains the X and Y coordinates in the Dutch locale, which means that they are written as 0,5 instead of 0.5."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import java.text.NumberFormat\nimport java.util.Locale\nval nf = NumberFormat.getInstance(Locale.forLanguageTag(\"nl\")); // Handle floats written as 0,05 instead of 0.05","outputs":[{"name":"stdout","output_type":"stream","text":"import java.text.NumberFormat\nimport java.util.Locale\nnf: java.text.NumberFormat = java.text.DecimalFormat@674dc\n"},{"metadata":{},"data":{"text/html":"java.text.DecimalFormat@674dc"},"output_type":"execute_result","execution_count":14}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addrDF = addresses.map( a => Addr(a(0), a(1), nf.parse(a(2)).floatValue, nf.parse(a(3)).floatValue) ).toDF().cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addrDF: org.apache.spark.sql.DataFrame = [street: string, quarter: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":15}]},{"metadata":{},"cell_type":"markdown","source":"Conversion to a DataFrame triggers an exception; and, if you build queries, you would find out that many queries fail. What is wrong?\n\nWhen you dig deeper, you find out that not all data are well formatted - the data dump contains address records where the x and/or y coordinates are empty; see e.g.:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val a = addresses.map( a => (a(0), a(2).length, a(3).length)).filter( _._2 == 0).count","outputs":[{"name":"stdout","output_type":"stream","text":"a: Long = 45\n"},{"metadata":{},"data":{"text/html":"45"},"output_type":"execute_result","execution_count":16}]},{"metadata":{},"cell_type":"markdown","source":"How to proceed is a decision that the data scientist needs to take - that is, it will be up to your judgement. Can we proceed without these records? In this case, the inconsistent records concern only a very small fraction of the data (45 out of almost 100K records), and we might decide to simply ignore these without valid `(x,y)` coordinates.\n\nIn many real life situations, however, we would need to invest more effort and clean the data to overcome these deficiencies. If you look into examples of records without coordinates (_Q: can you write the small numbers of lines of code to inspect these records?_), you find that some of these records have a value \"Niet authentiek\" in field STATUS, whereas almost all records have \"Naamgeving uitgegeven\". We lack the domain knowledge to understand the details of this labelling, and may need to dig deeper, or even have a chat with the owners of the data to learn how these values are assigned.\n\nKeep in mind that we only discovered this anomaly in the data when we attempted to define a proper schema, and discovered that the data did not satisfy that schema. Switching from transformations over RDDs to the more structured Data Frame representation can help avoid mistakes in the analysis.\n\n**Q:** _Do not forget to discuss your decisions in data selection and data cleaning that you took to complete the assignment in your blog post._"},{"metadata":{},"cell_type":"markdown","source":"The following solution keeps the outliers by mapping unknown coordinates to the origin."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import java.text.NumberFormat\nimport java.util.Locale\n\n// Handle floats written as 0,05 instead of 0.05 by overruling the Locale\nval nf = NumberFormat.getInstance(Locale.forLanguageTag(\"nl\"));\n\n// Make sure parseErrors are caught\ndef toFloat(s: String): Option[Float] = {\n  try {\n    Some(nf.parse(s).floatValue)\n  } catch {\n    case e: Exception => None\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"import java.text.NumberFormat\nimport java.util.Locale\nnf: java.text.NumberFormat = java.text.DecimalFormat@674dc\ntoFloat: (s: String)Option[Float]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":17}]},{"metadata":{},"cell_type":"markdown","source":"Example of using the new `toFloat` class:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"Seq( \"0.045\", \"0,054\", \"abc\", \"45.789,34\" ).map( x => toFloat(x).getOrElse(null))","outputs":[{"name":"stdout","output_type":"stream","text":"res6: Seq[Any] = List(45.0, 0.054, null, 45789.34)\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon7ff3c440ca5360c314fedbac5b929f0e&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;2096709210&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon8e668ae3de03400f94f4e57d0632f800\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anon8e668ae3de03400f94f4e57d0632f800\" type=\"number\" name=\"input-anon8e668ae3de03400f94f4e57d0632f800\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon8e668ae3de03400f94f4e57d0632f800\" data-this=\"{&quot;valueId&quot;:&quot;anon8e668ae3de03400f94f4e57d0632f800&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul2096709210\"><li>\n                <a href=\"#tab2096709210-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab2096709210-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n              </li><li>\n                <a href=\"#tab2096709210-2\"><i class=\"fa fa-line-chart\"/></a>\n              </li><li>\n                <a href=\"#tab2096709210-3\"><i class=\"fa fa-bar-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab2096709210\"><div class=\"tab-pane\" id=\"tab2096709210-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon5d0bc6224f8bf1b466f6866e9d704f40&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;646752697&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon296e7ebdeab20d6be0b594fee25a6c32\">\n      Max Points\n    </label><input id=\"input-anon296e7ebdeab20d6be0b594fee25a6c32\" type=\"number\" name=\"input-anon296e7ebdeab20d6be0b594fee25a6c32\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon296e7ebdeab20d6be0b594fee25a6c32\" data-this=\"{&quot;valueId&quot;:&quot;anon296e7ebdeab20d6be0b594fee25a6c32&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon4154c3a68f84289d8774ee717495fc1b&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon22d1f168aa2643d26e3e611912a2925f&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab2096709210-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon48e36fcfb94b5bbd53f74ae24d5dcdbd&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;1152469637&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon1b1ebbb34cc2443f57df6aaaafa8b122\">\n      Max Points\n    </label><input id=\"input-anon1b1ebbb34cc2443f57df6aaaafa8b122\" type=\"number\" name=\"input-anon1b1ebbb34cc2443f57df6aaaafa8b122\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon1b1ebbb34cc2443f57df6aaaafa8b122\" data-this=\"{&quot;valueId&quot;:&quot;anon1b1ebbb34cc2443f57df6aaaafa8b122&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonce166feb16c1bbd2f861268017432477&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon23e391a20901e3e9947915b5b26110cc&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab2096709210-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon0574d684a3c5d72c526eefb03c3541c9&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;1058019932&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonb72ecbabe4eb3cdc4a517afee36feac7\">\n      Max Points\n    </label><input id=\"input-anonb72ecbabe4eb3cdc4a517afee36feac7\" type=\"number\" name=\"input-anonb72ecbabe4eb3cdc4a517afee36feac7\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonb72ecbabe4eb3cdc4a517afee36feac7\" data-this=\"{&quot;valueId&quot;:&quot;anonb72ecbabe4eb3cdc4a517afee36feac7&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon456024d1730a2183b571f48d6c63d1b8&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon60e849b781e5777286205316fa83d1dc&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab2096709210-3\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anonca0ca4035aa8d2c533f6f7262333cb0c&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;1502168366&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonc286134f349870dc670e7540f0a88e01\">\n      Max Points\n    </label><input id=\"input-anonc286134f349870dc670e7540f0a88e01\" type=\"number\" name=\"input-anonc286134f349870dc670e7540f0a88e01\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonc286134f349870dc670e7540f0a88e01\" data-this=\"{&quot;valueId&quot;:&quot;anonc286134f349870dc670e7540f0a88e01&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf766ead05d4636419c2165de6969550c&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon07f6f3648def6d886436a77f788fca5b&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":18}]},{"metadata":{},"cell_type":"markdown","source":"Let us apply this conversion class to the data;\nan alternative for pre-filtering out records with an empty value."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addrDF = addresses\n      .map( a => Addr(a(0), a(1), \n                      toFloat(a(2).trim).getOrElse(0), \n                      toFloat(a(3).trim).getOrElse(0)) ).toDF().cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addrDF: org.apache.spark.sql.DataFrame = [street: string, quarter: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon36ba9464264654eb9b36d9a8a03bb80a&quot;,&quot;partitionIndexId&quot;:&quot;anonee9ba80b6c422906785cbe9084a7fbb5&quot;,&quot;numPartitions&quot;:3875,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;street&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;x&quot;,&quot;type&quot;:&quot;float&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;y&quot;,&quot;type&quot;:&quot;float&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":19}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addrDF.filter(\"x = 0 or y = 0\").count","outputs":[{"name":"stdout","output_type":"stream","text":"res7: Long = 45\n"},{"metadata":{},"data":{"text/html":"45"},"output_type":"execute_result","execution_count":20}]},{"metadata":{},"cell_type":"markdown","source":"Use `describe` to get an overview of the data:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addrDF.describe().show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+------------------+-----------------+\n|summary|                 x|                y|\n+-------+------------------+-----------------+\n|  count|             96867|            96867|\n|   mean|186127.98527491302|426885.0503964198|\n| stddev| 4458.416082436374|9399.084321173254|\n|    min|               0.0|              0.0|\n|    max|         190871.25|        433955.62|\n+-------+------------------+-----------------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":21}]},{"metadata":{},"cell_type":"markdown","source":"#### Using Data Frame Operators"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val qc_1 = addrDF.groupBy(\"quarter\").count.cache()","outputs":[{"name":"stdout","output_type":"stream","text":"qc_1: org.apache.spark.sql.DataFrame = [quarter: string, count: bigint]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon1a7a3fb53cfd37f42bce9b783c80e38d&quot;,&quot;partitionIndexId&quot;:&quot;anone2aabc31ce042538dd7decfbc82a3308&quot;,&quot;numPartitions&quot;:2,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;count&quot;,&quot;type&quot;:&quot;long&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":22}]},{"metadata":{},"cell_type":"markdown","source":"**Q:** _List the quarters with the largest number of addresses using the Data Frame API._\n\nThe text below assumes that you call the result `qc_1_top`."},{"metadata":{},"cell_type":"markdown","source":"Wondering what happens inside? The `explain` operator gives you the _physical_ query plan. If you add a boolean, you also see the logical plans, both the initial as parsed, and the plan that is the result of query optimization."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"println(\"Group by and count:\")\nqc_1.explain(true)\nprintln(\"Order descending limit 10:\")\nqc_1_top.explain(true)","outputs":[{"name":"stdout","output_type":"stream","text":"Group by and count:\n== Parsed Logical Plan ==\nAggregate [quarter#45], [quarter#45,(count(1),mode=Complete,isDistinct=false) AS count#332L]\n+- LogicalRDD [street#44,quarter#45,x#46,y#47], MapPartitionsRDD[17] at rddToDataFrameHolder at <console>:76\n\n== Analyzed Logical Plan ==\nquarter: string, count: bigint\nAggregate [quarter#45], [quarter#45,(count(1),mode=Complete,isDistinct=false) AS count#332L]\n+- LogicalRDD [street#44,quarter#45,x#46,y#47], MapPartitionsRDD[17] at rddToDataFrameHolder at <console>:76\n\n== Optimized Logical Plan ==\nInMemoryRelation [quarter#45,count#332L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#332L]), None\n\n== Physical Plan ==\nInMemoryColumnarTableScan [quarter#45,count#332L], InMemoryRelation [quarter#45,count#332L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#332L]), None\nOrder descending limit 10:\n== Parsed Logical Plan ==\nLimit 10\n+- Sort [count#332L DESC], true\n   +- Aggregate [quarter#45], [quarter#45,(count(1),mode=Complete,isDistinct=false) AS count#332L]\n      +- LogicalRDD [street#44,quarter#45,x#46,y#47], MapPartitionsRDD[17] at rddToDataFrameHolder at <console>:76\n\n== Analyzed Logical Plan ==\nquarter: string, count: bigint\nLimit 10\n+- Sort [count#332L DESC], true\n   +- Aggregate [quarter#45], [quarter#45,(count(1),mode=Complete,isDistinct=false) AS count#332L]\n      +- LogicalRDD [street#44,quarter#45,x#46,y#47], MapPartitionsRDD[17] at rddToDataFrameHolder at <console>:76\n\n== Optimized Logical Plan ==\nLimit 10\n+- Sort [count#332L DESC], true\n   +- InMemoryRelation [quarter#45,count#332L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#332L]), None\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=10, orderBy=[count#332L DESC], output=[quarter#45,count#332L])\n+- ConvertToSafe\n   +- InMemoryColumnarTableScan [quarter#45,count#332L], InMemoryRelation [quarter#45,count#332L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#332L]), None\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":39}]},{"metadata":{},"cell_type":"markdown","source":"#### Using SQL"},{"metadata":{},"cell_type":"markdown","source":"You are not restricted to building queryplans yourself by applying operators to Data Frames; instead, you can also use the SQL interface, and, mix and match SQL querying with follow-up operations using the Data Frame API, or even convert the data back to RDDs and continue to perform analyses directly working with RDDs."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addrDF.registerTempTable(\"addresses\")","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":30}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val qc_2_top = sqlContext.sql(\"SELECT quarter, count(quarter) AS qc FROM addresses GROUP BY quarter ORDER BY qc DESC LIMIT 10\")","outputs":[{"name":"stdout","output_type":"stream","text":"qc_2_top: org.apache.spark.sql.DataFrame = [quarter: string, qc: bigint]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon10848ee197b4ba6a2315c535b0c28728&quot;,&quot;partitionIndexId&quot;:&quot;anonaee780c18460340b16728d0c617f23e8&quot;,&quot;numPartitions&quot;:1,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;qc&quot;,&quot;type&quot;:&quot;long&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":31}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_2_top.show","outputs":[{"name":"stdout","output_type":"stream","text":"+--------------+----+\n|       quarter|  qc|\n+--------------+----+\n|  Stadscentrum|6473|\n|        Hatert|6388|\n|        Biezen|4945|\n|Neerbosch-Oost|4415|\n|          Lent|4333|\n|     Hengstdal|3871|\n|      Heseveld|3559|\n|    Galgenveld|3510|\n|       Altrade|3275|\n|     Grootstal|3079|\n+--------------+----+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":32}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_2_top.explain(true)","outputs":[{"name":"stdout","output_type":"stream","text":"== Parsed Logical Plan ==\n'Limit 10\n+- 'Sort ['qc DESC], true\n   +- 'Aggregate ['quarter], [unresolvedalias('quarter),unresolvedalias('count('quarter) AS qc#4512)]\n      +- 'UnresolvedRelation `addresses`, None\n\n== Analyzed Logical Plan ==\nquarter: string, qc: bigint\nLimit 10\n+- Sort [qc#4512L DESC], true\n   +- Aggregate [quarter#45], [quarter#45,(count(quarter#45),mode=Complete,isDistinct=false) AS qc#4512L]\n      +- Subquery addresses\n         +- LogicalRDD [street#44,quarter#45,x#46,y#47], MapPartitionsRDD[17] at rddToDataFrameHolder at <console>:76\n\n== Optimized Logical Plan ==\nLimit 10\n+- Sort [qc#4512L DESC], true\n   +- Aggregate [quarter#45], [quarter#45,(count(quarter#45),mode=Complete,isDistinct=false) AS qc#4512L]\n      +- Project [quarter#45]\n         +- InMemoryRelation [street#44,quarter#45,x#46,y#47], true, 10000, StorageLevel(true, true, false, true, 1), ConvertToUnsafe, None\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=10, orderBy=[qc#4512L DESC], output=[quarter#45,qc#4512L])\n+- ConvertToSafe\n   +- TungstenAggregate(key=[quarter#45], functions=[(count(quarter#45),mode=Final,isDistinct=false)], output=[quarter#45,qc#4512L])\n      +- TungstenExchange hashpartitioning(quarter#45,200), None\n         +- TungstenAggregate(key=[quarter#45], functions=[(count(quarter#45),mode=Partial,isDistinct=false)], output=[quarter#45,count#4698L])\n            +- InMemoryColumnarTableScan [quarter#45], InMemoryRelation [street#44,quarter#45,x#46,y#47], true, 10000, StorageLevel(true, true, false, true, 1), ConvertToUnsafe, None\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":40}]},{"metadata":{},"cell_type":"markdown","source":"### Events\n\nNow that we have the address data prepared, move on to look into the data about the events.\n\n[DataBricks](https://databricks.com/company/about-us), the Berkeley spin-off that was founded by the Spark creators, provides a different, tighter integrated CSV parsing library. \n\n\nLet's give that one a try as well; it is available from https://github.com/databricks/spark-csv, and, it is pre-installed on the Spark notebook. Load the data, look at the schema and global statistics, and inspect a small sample:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val ev = sqlContext.read\n    .format(\"com.databricks.spark.csv\")\n    .option(\"header\", \"true\") // Use first line of all files as header\n    .option(\"inferSchema\", \"true\") // Automatically infer data types\n    .load(\"/data/vBoaEvents_all.csv\")","outputs":[{"name":"stdout","output_type":"stream","text":"ev: org.apache.spark.sql.DataFrame = [eventid: int, typeid: int, typenaam: string, statusid: int, statusnaam: string, omschrijving: string, aanvrager: string, bezoekers: string, memorandum: string, website: string, toevoeg: int, wijzig: int]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":66}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"ev.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- typeid: integer (nullable = true)\n |-- typenaam: string (nullable = true)\n |-- statusid: integer (nullable = true)\n |-- statusnaam: string (nullable = true)\n |-- omschrijving: string (nullable = true)\n |-- aanvrager: string (nullable = true)\n |-- bezoekers: string (nullable = true)\n |-- memorandum: string (nullable = true)\n |-- website: string (nullable = true)\n |-- toevoeg: integer (nullable = true)\n |-- wijzig: integer (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":67}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"ev.describe()","outputs":[{"name":"stdout","output_type":"stream","text":"res43: org.apache.spark.sql.DataFrame = [summary: string, eventid: string, typeid: string, statusid: string, toevoeg: string, wijzig: string]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anona1e7afc627f146c8b0fc214ce3cefa52&quot;,&quot;partitionIndexId&quot;:&quot;anon8c48c0a7e2198127ee1b35509fffde43&quot;,&quot;numPartitions&quot;:1,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;summary&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;eventid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;typeid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;statusid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;toevoeg&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;wijzig&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":68}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val events = ev.select(\"eventid\",\"typeid\",\"typenaam\",\"statusid\",\"statusnaam\").where(\"typeid = 3 and statusid IN (6,10)\")","outputs":[{"name":"stdout","output_type":"stream","text":"events: org.apache.spark.sql.DataFrame = [eventid: int, typeid: int, typenaam: string, statusid: int, statusnaam: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":69}]},{"metadata":{"trusted":true,"input_collapsed":false,"output_stream_collapsed":true,"collapsed":false},"cell_type":"code","source":"events.describe()","outputs":[{"name":"stdout","output_type":"stream","text":"res44: org.apache.spark.sql.DataFrame = [summary: string, eventid: string, typeid: string, statusid: string]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon76ff6001ee4ae3c256c818c95b4fe06c&quot;,&quot;partitionIndexId&quot;:&quot;anone69dfb180985f9fe4bca8e33c9c437cb&quot;,&quot;numPartitions&quot;:1,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;summary&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;eventid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;typeid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;statusid&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":70}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"events.sample(true,0.1).show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+------+---------+--------+--------------------+\n|eventid|typeid| typenaam|statusid|          statusnaam|\n+-------+------+---------+--------+--------------------+\n|   2152|     3|evenement|      10|reservering (met ...|\n|   1938|     3|evenement|      10|reservering (met ...|\n|   1960|     3|evenement|      10|reservering (met ...|\n|   1968|     3|evenement|      10|reservering (met ...|\n|   2044|     3|evenement|      10|reservering (met ...|\n|   2051|     3|evenement|      10|reservering (met ...|\n|   2354|     3|evenement|       6|      in behandeling|\n|   2365|     3|evenement|       6|      in behandeling|\n+-------+------+---------+--------+--------------------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":71}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val evl = sqlContext.read\n    .format(\"com.databricks.spark.csv\")\n    .option(\"header\", \"true\") // Use first line of all files as header\n    .option(\"inferSchema\", \"true\") // Automatically infer data types\n    .load(\"/data/vBoaEventsLoc_all.csv\")","outputs":[{"name":"stdout","output_type":"stream","text":"evl: org.apache.spark.sql.DataFrame = [eventid: int, locatieid: int, evenementenlocatie: int, straat: string, plaats: string, x_koord: string, y_koord: string, statusid: int, statusnaam: string, eerste: int, eerstetijd: int, laatste: int, laatstetijd: int, eersteevent: int, laatsteevent: int, memorandum: string, toevoeg: int, wijzig: int]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":72}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evl.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- locatieid: integer (nullable = true)\n |-- evenementenlocatie: integer (nullable = true)\n |-- straat: string (nullable = true)\n |-- plaats: string (nullable = true)\n |-- x_koord: string (nullable = true)\n |-- y_koord: string (nullable = true)\n |-- statusid: integer (nullable = true)\n |-- statusnaam: string (nullable = true)\n |-- eerste: integer (nullable = true)\n |-- eerstetijd: integer (nullable = true)\n |-- laatste: integer (nullable = true)\n |-- laatstetijd: integer (nullable = true)\n |-- eersteevent: integer (nullable = true)\n |-- laatsteevent: integer (nullable = true)\n |-- memorandum: string (nullable = true)\n |-- toevoeg: integer (nullable = true)\n |-- wijzig: integer (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":73}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val evloc = evl.select(\"eventid\", \"straat\", \"x_koord\", \"y_koord\")","outputs":[{"name":"stdout","output_type":"stream","text":"evloc: org.apache.spark.sql.DataFrame = [eventid: int, straat: string, x_koord: string, y_koord: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":74}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evloc.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- straat: string (nullable = true)\n |-- x_koord: string (nullable = true)\n |-- y_koord: string (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":75}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"The coordinates are not correctly detected as floats - again, due to the Locale.\nA quick hack (but not robust code) to cast the values to floats:","outputs":[]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"// UGLY: this string transform needs to be replaced by proper Locale handling...\nval evlxy = evloc\n  .withColumn(\"x_koord\", translate(evloc.col(\"x_koord\"),\",\",\".\").cast(\"float\"))\n  .withColumn(\"y_koord\", translate(evloc.col(\"y_koord\"),\",\",\".\").cast(\"float\"))","outputs":[{"name":"stdout","output_type":"stream","text":"evlxy: org.apache.spark.sql.DataFrame = [eventid: int, straat: string, x_koord: float, y_koord: float]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":95}]},{"metadata":{},"cell_type":"markdown","source":"Let's inspect some of the data, using global information and a sample."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evlxy.sample(true,0.02).show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+-------------------+---------+---------+\n|eventid|             straat|  x_koord|  y_koord|\n+-------+-------------------+---------+---------+\n|   2242|         Plein 1944|187764.98|428698.16|\n|   2332|st. stephanusstraat| 187368.9|427685.28|\n|   2333|   witsenburgselaan|188397.16|427086.72|\n+-------+-------------------+---------+---------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":97}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evlxy.filter(\"eventid = 2235\").show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+--------+---------+--------+\n|eventid|  straat|  x_koord| y_koord|\n+-------+--------+---------+--------+\n|   2235|floraweg|186310.31|427677.2|\n+-------+--------+---------+--------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":98}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evlxy.describe().show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+------------------+------------------+------------------+\n|summary|           eventid|           x_koord|           y_koord|\n+-------+------------------+------------------+------------------+\n|  count|               256|               254|               254|\n|   mean|     2141.94921875| 187353.6221702756| 428145.9501722441|\n| stddev|173.42890660569324|1174.6637261744304|1325.0338349718593|\n|    min|              1920|         182371.55|         424108.97|\n|    max|              2385|         189677.95|          432038.4|\n+-------+------------------+------------------+------------------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":96}]},{"metadata":{},"cell_type":"markdown","source":"You see immediately that 2 coordinates are missing, given the difference in counts between `eventid` and `x_koord`. Let's inspect which are the problematic tuples:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"sqlContext.sql(\"SELECT * FROM eventloc WHERE x_koord IS NULL\").show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+------+-------+-------+\n|eventid|straat|x_koord|y_koord|\n+-------+------+-------+-------+\n|   2301|      |   null|   null|\n|   2345|      |   null|   null|\n+-------+------+-------+-------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":121}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"markdown","source":"You can simply ignore this, or define a new table that excludes the NULL values."},{"metadata":{},"cell_type":"markdown","source":"To continue, we need to join these tables.\n\nOne approach would use the coordinates.\nThe second approach would use string similarity - use shingling and a very easy shingle count threshold to find the matching tuples.\n\nThis notebook gives some hints on the first strategy; the rest is left as part of the assignment.\n\n**Q:** _Complete the analysis by further integrating the data. You may choose either approach to make the connection between the three datasets, or analyze the data using both methods and compare the results._"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"events.registerTempTable(\"events\")\nevlxy.registerTempTable(\"eventloc\")\nval el = sqlContext.sql(\n  \"SELECT e1.eventid e, straat a, x_koord x,y_koord y \" +\n  \"FROM events e1, eventloc e2 \" +\n  \"WHERE e1.eventid = e2.eventid\"\n)\nel.registerTempTable(\"el\")\nel.show()","outputs":[{"name":"stdout","output_type":"stream","text":"+----+--------------------+---------+---------+\n|   e|                   a|        x|        y|\n+----+--------------------+---------+---------+\n|2235|            floraweg|186310.31| 427677.2|\n|2236|        rivierstraat|186198.45| 429181.2|\n|2044|          Mari?nburg|188048.81| 428621.5|\n|2245|       Stationsplein| 187133.4| 428390.7|\n|2245|          houtstraat|187691.05|428823.62|\n|2245|  van welderenstraat|187800.62| 428391.3|\n|2245|          Mari?nburg|187972.64|428627.62|\n|2245|          Mari?nburg|188048.81| 428621.5|\n|2245|            Waalkade| 188140.2|429062.97|\n|2245|          Plein 1944|187764.98|428698.16|\n|2245|         Kelfkensbos| 188271.7|428786.38|\n|2245|van schaeck matho...|187283.84|428282.28|\n|2245|    tweede walstraat|187849.64| 428445.8|\n|2245|        Ganzenheuvel|187665.56|428910.62|\n|2245|       marikenstraat| 188022.1|428704.12|\n|2245|         waalbandijk|186947.05| 429105.6|\n|2245|   lange hezelstraat| 187484.9| 428946.5|\n|2047|              Wedren|188016.73| 428163.4|\n|2048|     Centrum straten| 187813.9|428865.72|\n|2248|         Grote Markt|187838.75|428880.16|\n+----+--------------------+---------+---------+\nonly showing top 20 rows\n\nel: org.apache.spark.sql.DataFrame = [e: int, a: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":120}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val t = sqlContext.sql(\n  \"SELECT DISTINCT e, a, quarter as w \" + \n  \"FROM el, addresses aa \" +\n  \"WHERE (abs(el.x - aa.x) < 50) and (abs(el.y - aa.y) < 50) \").cache()\nt.registerTempTable(\"t\")","outputs":[{"name":"stdout","output_type":"stream","text":"t: org.apache.spark.sql.DataFrame = [e: int, a: string, w: string]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":128}]},{"metadata":{"trusted":true,"input_collapsed":false,"output_stream_collapsed":true,"collapsed":false},"cell_type":"code","source":"t.count()","outputs":[{"name":"stdout","output_type":"stream","text":"res89: Long = 72\n"},{"metadata":{},"data":{"text/html":"72"},"output_type":"execute_result","execution_count":129}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"sqlContext.sql(\"SELECT DISTINCT e FROM el\").count()","outputs":[{"name":"stdout","output_type":"stream","text":"res99: Long = 36\n"},{"metadata":{},"data":{"text/html":"36"},"output_type":"execute_result","execution_count":139}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"sqlContext.sql(\"SELECT DISTINCT e,w FROM t, el WHERE t.e \").count","outputs":[{"name":"stdout","output_type":"stream","text":"res96: Long = 51\n"},{"metadata":{},"data":{"text/html":"51"},"output_type":"execute_result","execution_count":136}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"sqlContext.sql(\n  \"SELECT e, el.x - aa.x as dx, el.y - aa.y as dy, a, quarter as w \" + \n  \"FROM el, addresses aa \" +\n  \"WHERE (abs(el.x - aa.x) < 10) and (abs(el.y - aa.y) < 10) \")","outputs":[{"name":"stdout","output_type":"stream","text":"res97: org.apache.spark.sql.DataFrame = [e: int, dx: float, dy: float, a: string, w: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":137}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"res97.show()","outputs":[{"name":"stdout","output_type":"stream","text":"+----+---------+--------+--------------------+------------+\n|   e|       dx|      dy|                   a|           w|\n+----+---------+--------+--------------------+------------+\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|-6.515625| -9.0625|          houtstraat|Stadscentrum|\n|2245|  -9.8125|-9.59375|  van welderenstraat|Stadscentrum|\n|2245| 9.890625| 1.46875|  van welderenstraat|Stadscentrum|\n|2245|  5.71875| -0.5625|  van welderenstraat|Stadscentrum|\n|2245|  5.71875| -0.5625|  van welderenstraat|Stadscentrum|\n|2245|  -0.9375|-2.28125|  van welderenstraat|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n|2245| 7.984375| 8.96875|van schaeck matho...|Stadscentrum|\n+----+---------+--------+--------------------+------------+\nonly showing top 20 rows\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":138}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"","outputs":[]}],"nbformat":4}