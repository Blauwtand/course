{"metadata":{"name":"Nijmegen","user_save_timestamp":"1970-01-01T00:00:00.000Z","auto_save_timestamp":"1970-01-01T00:00:00.000Z","language_info":{"name":"scala","file_extension":"scala","codemirror_mode":"text/x-scala"},"trusted":true,"customLocalRepo":null,"customRepos":null,"customDeps":null,"customImports":null,"customArgs":null,"customSparkConf":null},"cells":[{"metadata":{},"cell_type":"markdown","source":"# Nijmegen Open Data\n\nSpark Notebook to help you analyze data sets provided by Nijmegen's city council."},{"metadata":{},"cell_type":"markdown","source":"## Nijmegen data\n\nThe city of Nijmegen provides a variety of resources as open data at\n[nijmegen.nl/opendata](http://www.nijmegen.nl/opendata/).\n\nOur analysis requires a few of those combined:\n- `vBoaEvents_all.csv` and `vBoaEventsLoc_all.csv` for events and their locations\n- `BAG_ADRES.csv` for streetnames and their quarters\n- `opendata_stadsgetallen.accdb` for a variety of statistics about the population"},{"metadata":{},"cell_type":"markdown","source":"### Addresses and Quarters\n\nQuarters are listed in the basic address information from the so-called BAG (_basisadministratie adressen en gebouwen_, i.e., records of addresses and buildings)."},{"metadata":{},"cell_type":"markdown","source":"Just using split may work in some cases, but as soon as quoted values contain commas, we would get in trouble.\n\nLet us instead parse the CSV Files using a widely used open source parser, see http://opencsv.sourceforge.net/"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import au.com.bytecode.opencsv.CSVParser","outputs":[{"name":"stdout","output_type":"stream","text":"import au.com.bytecode.opencsv.CSVParser\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":9}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagdata = sc.textFile(\"/data/BAG_ADRES.csv\").cache()","outputs":[{"name":"stdout","output_type":"stream","text":"bagdata: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at textFile at <console>:46\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[1] at textFile at &lt;console&gt;:46"},"output_type":"execute_result","execution_count":10}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"bagdata.take(2)","outputs":[{"name":"stdout","output_type":"stream","text":"res7: Array[String] = Array(ACTCODE,ADRES_ID,ADR_ADRESNR,HUISLETTER,HUISNUMMER,HUISNUMMERTOEVOEGING,OPENBARERUIMTE_ID,POSTK_A,POSTK_N,STADSDEEL,STATUS,STRAAT,STRAAT_OFF,STRAAT_OFF_D,VOLGNR,WIJKCODE,WIJK_OMS,WOONPLAATS,X_COORD,Y_COORD, A,0268200000097065,,,9,A25,0268300000001013,AS,6522,Nijmegen-Oost,Naamgeving uitgegeven,Dr. Claas Noorduijnstraat,Dr. Claas Noorduijnstr,Dr. Claas Noorduijnstr,2,05,Hunnerberg,Nijmegen,\"188670,929999999990000\",\"428403,169999999980000\")\n"},{"metadata":{},"data":{"text/html":"<div class=\"container-fluid\"><div><div class=\"col-md-12\"><div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anone2beb8c7d6c1326a843115a17462bb62&quot;,&quot;dataInit&quot;:[{&quot;string value&quot;:&quot;ACTCODE,ADRES_ID,ADR_ADRESNR,HUISLETTER,HUISNUMMER,HUISNUMMERTOEVOEGING,OPENBARERUIMTE_ID,POSTK_A,POSTK_N,STADSDEEL,STATUS,STRAAT,STRAAT_OFF,STRAAT_OFF_D,VOLGNR,WIJKCODE,WIJK_OMS,WOONPLAATS,X_COORD,Y_COORD&quot;},{&quot;string value&quot;:&quot;A,0268200000097065,,,9,A25,0268300000001013,AS,6522,Nijmegen-Oost,Naamgeving uitgegeven,Dr. Claas Noorduijnstraat,Dr. Claas Noorduijnstr,Dr. Claas Noorduijnstr,2,05,Hunnerberg,Nijmegen,\\&quot;188670,929999999990000\\&quot;,\\&quot;428403,169999999980000\\&quot;&quot;}],&quot;genId&quot;:&quot;886861133&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"string value\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anone9b765fdcde17744278e649409640593\">\n      Max Points\n    </label><input id=\"input-anone9b765fdcde17744278e649409640593\" type=\"number\" name=\"input-anone9b765fdcde17744278e649409640593\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anone9b765fdcde17744278e649409640593\" data-this=\"{&quot;valueId&quot;:&quot;anone9b765fdcde17744278e649409640593&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon9b580459bd7d86221a9b02f88a8cb573&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf13fcf08c092059c1593894817333310&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div></div></div></div>"},"output_type":"execute_result","execution_count":11}]},{"metadata":{},"cell_type":"markdown","source":"Quite common in practice: the first line of the data shared as CSV contains the schema information.\n\nWe write a utility function to ignore the first element of the first RDD partition; and, while at it, also code a few lines of Scala to help process the first line and access to fields by their names instead of numbers."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagHeader = bagdata.take(1).mkString.split(\",\").zipWithIndex","outputs":[{"name":"stdout","output_type":"stream","text":"bagHeader: Array[(String, Int)] = Array((ACTCODE,0), (ADRES_ID,1), (ADR_ADRESNR,2), (HUISLETTER,3), (HUISNUMMER,4), (HUISNUMMERTOEVOEGING,5), (OPENBARERUIMTE_ID,6), (POSTK_A,7), (POSTK_N,8), (STADSDEEL,9), (STATUS,10), (STRAAT,11), (STRAAT_OFF,12), (STRAAT_OFF_D,13), (VOLGNR,14), (WIJKCODE,15), (WIJK_OMS,16), (WOONPLAATS,17), (X_COORD,18), (Y_COORD,19))\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon87ee3e095cf43cbcddfbec4fe9352360&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;97640687&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonb627495eff1f08b403b0be41f7c3f3ef\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anonb627495eff1f08b403b0be41f7c3f3ef\" type=\"number\" name=\"input-anonb627495eff1f08b403b0be41f7c3f3ef\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonb627495eff1f08b403b0be41f7c3f3ef\" data-this=\"{&quot;valueId&quot;:&quot;anonb627495eff1f08b403b0be41f7c3f3ef&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul97640687\"><li>\n                <a href=\"#tab97640687-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab97640687-1\"><i class=\"fa fa-bar-chart\"/></a>\n              </li><li>\n                <a href=\"#tab97640687-2\"><i class=\"fa fa-pie-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab97640687\"><div class=\"tab-pane\" id=\"tab97640687-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon305b19069111d409d45dfd65743758b4&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1668158212&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon2f899a37f5757658daa26ca628a78850\">\n      Max Points\n    </label><input id=\"input-anon2f899a37f5757658daa26ca628a78850\" type=\"number\" name=\"input-anon2f899a37f5757658daa26ca628a78850\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon2f899a37f5757658daa26ca628a78850\" data-this=\"{&quot;valueId&quot;:&quot;anon2f899a37f5757658daa26ca628a78850&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon10ebf524e285683143c67b1eb14da8a2&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anondd8a1a794c1794362392a9156c7b63b4&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab97640687-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon0ff3c60cc056771a452619464d36627c&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1005315033&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon14d081a8e33ee82c3dc72031523b57bd\">\n      Max Points\n    </label><input id=\"input-anon14d081a8e33ee82c3dc72031523b57bd\" type=\"number\" name=\"input-anon14d081a8e33ee82c3dc72031523b57bd\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon14d081a8e33ee82c3dc72031523b57bd\" data-this=\"{&quot;valueId&quot;:&quot;anon14d081a8e33ee82c3dc72031523b57bd&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon49274037428edda919b935c9c64c78de&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon68b64a7ba0add92a510bc69adfaeb1b6&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab97640687-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anond03308398c3ff3d904b58cdc89203a65&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:&quot;ACTCODE&quot;,&quot;_2&quot;:0},{&quot;_1&quot;:&quot;ADRES_ID&quot;,&quot;_2&quot;:1},{&quot;_1&quot;:&quot;ADR_ADRESNR&quot;,&quot;_2&quot;:2},{&quot;_1&quot;:&quot;HUISLETTER&quot;,&quot;_2&quot;:3},{&quot;_1&quot;:&quot;HUISNUMMER&quot;,&quot;_2&quot;:4},{&quot;_1&quot;:&quot;HUISNUMMERTOEVOEGING&quot;,&quot;_2&quot;:5},{&quot;_1&quot;:&quot;OPENBARERUIMTE_ID&quot;,&quot;_2&quot;:6},{&quot;_1&quot;:&quot;POSTK_A&quot;,&quot;_2&quot;:7},{&quot;_1&quot;:&quot;POSTK_N&quot;,&quot;_2&quot;:8},{&quot;_1&quot;:&quot;STADSDEEL&quot;,&quot;_2&quot;:9},{&quot;_1&quot;:&quot;STATUS&quot;,&quot;_2&quot;:10},{&quot;_1&quot;:&quot;STRAAT&quot;,&quot;_2&quot;:11},{&quot;_1&quot;:&quot;STRAAT_OFF&quot;,&quot;_2&quot;:12},{&quot;_1&quot;:&quot;STRAAT_OFF_D&quot;,&quot;_2&quot;:13},{&quot;_1&quot;:&quot;VOLGNR&quot;,&quot;_2&quot;:14},{&quot;_1&quot;:&quot;WIJKCODE&quot;,&quot;_2&quot;:15},{&quot;_1&quot;:&quot;WIJK_OMS&quot;,&quot;_2&quot;:16},{&quot;_1&quot;:&quot;WOONPLAATS&quot;,&quot;_2&quot;:17},{&quot;_1&quot;:&quot;X_COORD&quot;,&quot;_2&quot;:18},{&quot;_1&quot;:&quot;Y_COORD&quot;,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1433793816&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pieChart'], \n      function(playground, _magicpieChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpieChart,\n    \"o\": {\"series\":\"_1\",\"p\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon24c88ecaaa5e7e31ded401275985fbc0\">\n      Max Points\n    </label><input id=\"input-anon24c88ecaaa5e7e31ded401275985fbc0\" type=\"number\" name=\"input-anon24c88ecaaa5e7e31ded401275985fbc0\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon24c88ecaaa5e7e31ded401275985fbc0\" data-this=\"{&quot;valueId&quot;:&quot;anon24c88ecaaa5e7e31ded401275985fbc0&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonb59752869186ff90f3f3f161814c6e7c&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonbe06187a5b651d7d07400f8989e3163f&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":12}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"def fno(hdr: Array[(String,Int)], fnm: String):Int = {\n  hdr.find(_._1.startsWith(fnm)).get._2\n}\n\nval fnos = Array( fno(bagHeader, \"STRAAT_OFF\"), fno(bagHeader, \"WIJK_\"), fno(bagHeader, \"X_\"), fno( bagHeader, \"Y_\"))","outputs":[{"name":"stdout","output_type":"stream","text":"fno: (hdr: Array[(String, Int)], fnm: String)Int\nfnos: Array[Int] = Array(12, 16, 18, 19)\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon73fdb1ba179af3ca30bde8dafd0248fd&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;304854498&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonf5fc13df0bb6ea6c1ef75372796b8897\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anonf5fc13df0bb6ea6c1ef75372796b8897\" type=\"number\" name=\"input-anonf5fc13df0bb6ea6c1ef75372796b8897\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonf5fc13df0bb6ea6c1ef75372796b8897\" data-this=\"{&quot;valueId&quot;:&quot;anonf5fc13df0bb6ea6c1ef75372796b8897&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul304854498\"><li>\n                <a href=\"#tab304854498-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab304854498-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n              </li><li>\n                <a href=\"#tab304854498-2\"><i class=\"fa fa-line-chart\"/></a>\n              </li><li>\n                <a href=\"#tab304854498-3\"><i class=\"fa fa-bar-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab304854498\"><div class=\"tab-pane\" id=\"tab304854498-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon6fb1250193ab023d6873eb692b4c8993&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1281185213&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anona0035860ad89605352e5b2469de5e342\">\n      Max Points\n    </label><input id=\"input-anona0035860ad89605352e5b2469de5e342\" type=\"number\" name=\"input-anona0035860ad89605352e5b2469de5e342\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anona0035860ad89605352e5b2469de5e342\" data-this=\"{&quot;valueId&quot;:&quot;anona0035860ad89605352e5b2469de5e342&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon0220e1b102f6e56c67194589f3442796&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon0b407bcf85866fa43166f66ef0fbef16&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab304854498-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anona73ed1600ddb8a1b3323152235eb3ccd&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;921160824&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon1f8a2df2b2dca618ec6f945d29bda2b9\">\n      Max Points\n    </label><input id=\"input-anon1f8a2df2b2dca618ec6f945d29bda2b9\" type=\"number\" name=\"input-anon1f8a2df2b2dca618ec6f945d29bda2b9\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon1f8a2df2b2dca618ec6f945d29bda2b9\" data-this=\"{&quot;valueId&quot;:&quot;anon1f8a2df2b2dca618ec6f945d29bda2b9&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon9274b0366293dfe9465ffe7aac6ae563&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon1d5c5932892ba56e686e71064d7a117e&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab304854498-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon1174435b151cded5e5aa2c2e8b4e3671&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1638951515&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon5c8b6f64703531a816efe7348319d9f8\">\n      Max Points\n    </label><input id=\"input-anon5c8b6f64703531a816efe7348319d9f8\" type=\"number\" name=\"input-anon5c8b6f64703531a816efe7348319d9f8\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon5c8b6f64703531a816efe7348319d9f8\" data-this=\"{&quot;valueId&quot;:&quot;anon5c8b6f64703531a816efe7348319d9f8&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon991ecda70621bc63cf03092631604795&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonc23264eecc22fdef93c48bbefa770c09&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab304854498-3\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anond1eed2be30e74bb78570ba7c7ff70bee&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:12},{&quot;_1&quot;:1,&quot;_2&quot;:16},{&quot;_1&quot;:2,&quot;_2&quot;:18},{&quot;_1&quot;:3,&quot;_2&quot;:19}],&quot;genId&quot;:&quot;1536824687&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon20567494ed069f84ece1c3c3de3d5729\">\n      Max Points\n    </label><input id=\"input-anon20567494ed069f84ece1c3c3de3d5729\" type=\"number\" name=\"input-anon20567494ed069f84ece1c3c3de3d5729\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon20567494ed069f84ece1c3c3de3d5729\" data-this=\"{&quot;valueId&quot;:&quot;anon20567494ed069f84ece1c3c3de3d5729&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon937cf874075a5003bbb51f4b273c505e&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anond211a7ac56353f9d38d43db693049773&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":13}]},{"metadata":{},"cell_type":"markdown","source":"A scala function that skips the first record of the first partition, using the `mapPartitionsWithIndex` operator."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"def dropHeader(data: RDD[String]): RDD[String] = {\n         data.mapPartitionsWithIndex((idx, lines) => {\n           if (idx == 0) {\n             lines.drop(1)\n           }\n           lines\n         })\n       }","outputs":[{"name":"stdout","output_type":"stream","text":"dropHeader: (data: org.apache.spark.rdd.RDD[String])org.apache.spark.rdd.RDD[String]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":14}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val bagNoHeader: RDD[String] = dropHeader(bagdata).cache()","outputs":[{"name":"stdout","output_type":"stream","text":"bagNoHeader: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[2] at mapPartitionsWithIndex at <console>:47\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[2] at mapPartitionsWithIndex at &lt;console&gt;:47"},"output_type":"execute_result","execution_count":15}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addresses = bagNoHeader.mapPartitions(lines => {\n         val parser = new CSVParser(',')\n         lines.map(line => {\n           val fields = parser.parseLine(line)\n           fnos.map(fields(_))\n         })\n       }).cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addresses: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[3] at mapPartitions at <console>:52\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[3] at mapPartitions at &lt;console&gt;:52"},"output_type":"execute_result","execution_count":16}]},{"metadata":{},"cell_type":"markdown","source":"### Analysis using RDDs"},{"metadata":{},"cell_type":"markdown","source":"Using the `addresses` RDD, we can easily summarize statistics, e.g., to determine the number of addresses, or the number of addresses listed per quarter."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addresses.count","outputs":[{"name":"stdout","output_type":"stream","text":"res8: Long = 96867\n"},{"metadata":{},"data":{"text/html":"96867"},"output_type":"execute_result","execution_count":17}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addresses\n  .map{\n    case Array(_,w,_,_) => (w, 1)\n  }\n  .reduceByKey( _ + _ )\n  .takeOrdered(10)(Ordering[Int].reverse.on(x=>x._2))\n  .foreach(println)","outputs":[{"name":"stdout","output_type":"stream","text":"(Stadscentrum,6473)\n(Hatert,6388)\n(Biezen,4945)\n(Neerbosch-Oost,4415)\n(Lent,4333)\n(Hengstdal,3871)\n(Heseveld,3559)\n(Galgenveld,3510)\n(Altrade,3275)\n(Grootstal,3079)\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":18}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addresses.toDebugString","outputs":[{"name":"stdout","output_type":"stream","text":"res10: String =\n(2) MapPartitionsRDD[3] at mapPartitions at <console>:52 [Memory Deserialized 1x Replicated]\n |       CachedPartitions: 2; MemorySize: 31.7 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  MapPartitionsRDD[2] at mapPartitionsWithIndex at <console>:47 [Memory Deserialized 1x Replicated]\n |      CachedPartitions: 2; MemorySize: 43.1 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  MapPartitionsRDD[1] at textFile at <console>:46 [Memory Deserialized 1x Replicated]\n |      CachedPartitions: 2; MemorySize: 42.9 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  /data/BAG_ADRES.csv HadoopRDD[0] at textFile at <console>:46 [Memory Deserialized 1x Replicated]\n"},{"metadata":{},"data":{"text/html":"(2) MapPartitionsRDD[3] at mapPartitions at &lt;console&gt;:52 [Memory Deserialized 1x Replicated]\n |       CachedPartitions: 2; MemorySize: 31.7 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  MapPartitionsRDD[2] at mapPartitionsWithIndex at &lt;console&gt;:47 [Memory Deserialized 1x Replicated]\n |      CachedPartitions: 2; MemorySize: 43.1 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  MapPartitionsRDD[1] at textFile at &lt;console&gt;:46 [Memory Deserialized 1x Replicated]\n |      CachedPartitions: 2; MemorySize: 42.9 MB; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B\n |  /data/BAG_ADRES.csv HadoopRDD[0] at textFile at &lt;console&gt;:46 [Memory Deserialized 1x Replicated]"},"output_type":"execute_result","execution_count":19}]},{"metadata":{},"cell_type":"markdown","source":"### Analysis using the Data Frame API"},{"metadata":{},"cell_type":"markdown","source":"We can also define a Data Frame for the data, which simplifies the processing of more complex queries."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val sqlContext = new org.apache.spark.sql.SQLContext(sc)\n\n// Special construct to allow implicit conversion of RDDs to DataFrames:\nimport sqlContext.implicits._\n\n// Additional imports needed:\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions._","outputs":[{"name":"stdout","output_type":"stream","text":"sqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@4b3d8991\nimport sqlContext.implicits._\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions._\n"},{"metadata":{},"data":{"text/html":"org.apache.spark.sql.SQLContext$implicits$@7f1df101"},"output_type":"execute_result","execution_count":20}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"case class Addr(street:String, quarter:String, x:Float, y:Float)\norg.apache.spark.sql.catalyst.encoders.OuterScopes.addOuterScope(this)","outputs":[{"name":"stdout","output_type":"stream","text":"defined class Addr\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":21}]},{"metadata":{},"cell_type":"markdown","source":"Actually, parsing the X and Y coordinates is a little messy: the data contains the X and Y coordinates in the Dutch locale, which means that they are written as 0,5 instead of 0.5."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import java.text.NumberFormat\nimport java.util.Locale\nval nf = NumberFormat.getInstance(Locale.forLanguageTag(\"nl\")); // Handle floats written as 0,05 instead of 0.05","outputs":[{"name":"stdout","output_type":"stream","text":"import java.text.NumberFormat\nimport java.util.Locale\nnf: java.text.NumberFormat = java.text.DecimalFormat@674dc\n"},{"metadata":{},"data":{"text/html":"java.text.DecimalFormat@674dc"},"output_type":"execute_result","execution_count":22}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addrDF = addresses.map( a => Addr(a(0), a(1), nf.parse(a(2)).floatValue, nf.parse(a(3)).floatValue) ).toDF().cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addrDF: org.apache.spark.sql.DataFrame = [street: string, quarter: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":23}]},{"metadata":{},"cell_type":"markdown","source":"Conversion to a DataFrame triggers an exception; and, if you build queries, you would find out that many queries fail. What is wrong?\n\nWhen you dig deeper, you find out that not all data are well formatted - the data dump contains address records where the x and/or y coordinates are empty:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val a = addresses.map( a => (a(0), a(2).length, a(3).length)).filter( _._2 == 0).count","outputs":[{"name":"stdout","output_type":"stream","text":"a: Long = 45\n"},{"metadata":{},"data":{"text/html":"45"},"output_type":"execute_result","execution_count":24}]},{"metadata":{},"cell_type":"markdown","source":"How to proceed is a decision that the data scientist needs to take - that is, it will be up to your judgement. Can we proceed without these records? In this case, the inconsistent records concern only a very small fraction of the data (45 out of almost 100K records), and we might decide to simply ignore these without valid `(x,y)` coordinates.\n\nIn many real life situations, however, we would need to invest more effort and clean the data to overcome these deficiencies. If you look into examples of records without coordinates (_Q: can you write the small numbers of lines of code to inspect these records?_), you find that some of these records have a value \"Niet authentiek\" in field STATUS, whereas almost all records have \"Naamgeving uitgegeven\". We lack the domain knowledge to understand the details of this labelling, and may need to dig deeper, or even have a chat with the owners of the data to learn how these values are assigned.\n\nKeep in mind that we only discovered this anomaly in the data when we attempted to define a proper schema, and discovered that the data did not satisfy that schema. Switching from transformations over RDDs to the more structured Data Frame representation can help avoid mistakes in the analysis."},{"metadata":{},"cell_type":"markdown","source":"The following solution keeps the outliers by mapping unknown coordinates to the origin."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import java.text.NumberFormat\nimport java.util.Locale\n\n// Handle floats written as 0,05 instead of 0.05 by overruling the Locale\nval nf = NumberFormat.getInstance(Locale.forLanguageTag(\"nl\"));\n\n// Make sure parseErrors are caught\ndef toFloat(s: String): Option[Float] = {\n  try {\n    Some(nf.parse(s).floatValue)\n  } catch {\n    case e: Exception => None\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"import java.text.NumberFormat\nimport java.util.Locale\nnf: java.text.NumberFormat = java.text.DecimalFormat@674dc\ntoFloat: (s: String)Option[Float]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":25}]},{"metadata":{},"cell_type":"markdown","source":"Example of using the new `toFloat` class:"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"Seq( \"0.045\", \"0,054\", \"abc\", \"45.789,34\" ).map( x => toFloat(x).getOrElse(null))","outputs":[{"name":"stdout","output_type":"stream","text":"res12: Seq[Any] = List(45.0, 0.054, null, 45789.34)\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon7784a16590f39dd572ad5cf75b593ecf&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;794412081&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon4448d90b7ddd5f6178243d6a23c3dc38\">\n      Max Points (controlling all tabs)\n    </label><input id=\"input-anon4448d90b7ddd5f6178243d6a23c3dc38\" type=\"number\" name=\"input-anon4448d90b7ddd5f6178243d6a23c3dc38\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon4448d90b7ddd5f6178243d6a23c3dc38\" data-this=\"{&quot;valueId&quot;:&quot;anon4448d90b7ddd5f6178243d6a23c3dc38&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <div>\n          <ul class=\"nav nav-tabs\" id=\"ul794412081\"><li>\n                <a href=\"#tab794412081-0\"><i class=\"fa fa-table\"/></a>\n              </li><li>\n                <a href=\"#tab794412081-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n              </li><li>\n                <a href=\"#tab794412081-2\"><i class=\"fa fa-line-chart\"/></a>\n              </li><li>\n                <a href=\"#tab794412081-3\"><i class=\"fa fa-bar-chart\"/></a>\n              </li></ul>\n\n          <div class=\"tab-content\" id=\"tab794412081\"><div class=\"tab-pane\" id=\"tab794412081-0\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anona26b513381fa7362d747240b5e4d4920&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;1488300671&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"_1\",\"_2\"],\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon2143508ecac2828a93d367ffced0df59\">\n      Max Points\n    </label><input id=\"input-anon2143508ecac2828a93d367ffced0df59\" type=\"number\" name=\"input-anon2143508ecac2828a93d367ffced0df59\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon2143508ecac2828a93d367ffced0df59\" data-this=\"{&quot;valueId&quot;:&quot;anon2143508ecac2828a93d367ffced0df59&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonccbc86ecc0fcda2b6c1f88fdf317ae53&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anondee8098b421ff3519666a457c75e708b&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab794412081-1\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon93514e9bf4e6ec14b3f795a8b4b7100e&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;383957146&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anonb887658da58015613f47476f125ecb58\">\n      Max Points\n    </label><input id=\"input-anonb887658da58015613f47476f125ecb58\" type=\"number\" name=\"input-anonb887658da58015613f47476f125ecb58\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anonb887658da58015613f47476f125ecb58\" data-this=\"{&quot;valueId&quot;:&quot;anonb887658da58015613f47476f125ecb58&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon541eae6df0e82fee636f1b70ed8b9a37&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anona5782be8ed5eba3ad2e914ffb6182c8d&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab794412081-2\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon929144e8ca3feab8e627a1f30b8ad247&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;936867180&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon7c7bf3fb716e33d1de147094e2cceb1c\">\n      Max Points\n    </label><input id=\"input-anon7c7bf3fb716e33d1de147094e2cceb1c\" type=\"number\" name=\"input-anon7c7bf3fb716e33d1de147094e2cceb1c\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon7c7bf3fb716e33d1de147094e2cceb1c\" data-this=\"{&quot;valueId&quot;:&quot;anon7c7bf3fb716e33d1de147094e2cceb1c&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon26c1213aa8dc63f8778a45a09de0ceea&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon42b75b25db1a50cfd94c96a13ae1d779&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div><div class=\"tab-pane\" id=\"tab794412081-3\">\n              <div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anone6cf690b2954207b5951eb7b1c9c0f24&quot;,&quot;dataInit&quot;:[{&quot;_1&quot;:0,&quot;_2&quot;:45.0},{&quot;_1&quot;:1,&quot;_2&quot;:0.05400000140070915},{&quot;Null&quot;:&quot;&lt;null-value&gt;&quot;},{&quot;_1&quot;:3,&quot;_2&quot;:45789.33984375}],&quot;genId&quot;:&quot;123812919&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"_1\",\"y\":\"_2\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n        <label for=\"input-anon10cd77abc9aaa3d3a8a937c54199c745\">\n      Max Points\n    </label><input id=\"input-anon10cd77abc9aaa3d3a8a937c54199c745\" type=\"number\" name=\"input-anon10cd77abc9aaa3d3a8a937c54199c745\" data-bind=\"textInput: value, fireChange: true, valueUpdate: 'input'\">\n      <script data-selector=\"#input-anon10cd77abc9aaa3d3a8a937c54199c745\" data-this=\"{&quot;valueId&quot;:&quot;anon10cd77abc9aaa3d3a8a937c54199c745&quot;,&quot;valueInit&quot;:25}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(\n ['observable', 'knockout'],\n function (Observable, ko) {\n   //console.log(\"-----------\")\n   //console.dir(this);\n   //console.dir(valueId);\n   var obs = Observable.makeObservable(valueId)\n                       .extend({ rateLimit: { //throttle\n                                   timeout: 500,\n                                   method: \"notifyWhenChangesStop\"\n                                 }\n                               }\n                       );\n   ko.applyBindings({\n     value: obs\n   }, this);\n   obs(valueInit);\n }\n)/*]]>*/</script>\n    </input>\n        <p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon4bad747a292990be26a0c0dd3fbd6872&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> <span style=\"color:red\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon21ce777854966eef36ded0bc1cd52c75&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n        <div>\n        </div>\n      </div></div>\n              </div></div>\n        </div>\n      </div></div>"},"output_type":"execute_result","execution_count":26}]},{"metadata":{},"cell_type":"markdown","source":"Let us apply this conversion class to the data;\nan alternative for pre-filtering out records with an empty value."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val addrDF = addresses\n      .map( a => Addr(a(0), a(1), \n                      toFloat(a(2).trim).getOrElse(0), \n                      toFloat(a(3).trim).getOrElse(0)) ).toDF().cache()","outputs":[{"name":"stdout","output_type":"stream","text":"addrDF: org.apache.spark.sql.DataFrame = [street: string, quarter: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anonf17ba33fe26aac5862d7ed71b4bdaeeb&quot;,&quot;partitionIndexId&quot;:&quot;anone36a9d82910d0ef50893283ceb692561&quot;,&quot;numPartitions&quot;:3875,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;street&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;x&quot;,&quot;type&quot;:&quot;float&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;y&quot;,&quot;type&quot;:&quot;float&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":27}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addrDF.filter(\"x = 0 or y = 0\").count","outputs":[{"name":"stdout","output_type":"stream","text":"res13: Long = 45\n"},{"metadata":{},"data":{"text/html":"45"},"output_type":"execute_result","execution_count":28}]},{"metadata":{},"cell_type":"markdown","source":"#### Using Data Frame Operators"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val qc_1 = addrDF.groupBy(\"quarter\").count.cache()","outputs":[{"name":"stdout","output_type":"stream","text":"qc_1: org.apache.spark.sql.DataFrame = [quarter: string, count: bigint]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anondc03b5a3e753b2e01c29be5234575071&quot;,&quot;partitionIndexId&quot;:&quot;anon5d2ddd1f355a9c82f8416cd6da6e717b&quot;,&quot;numPartitions&quot;:2,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;count&quot;,&quot;type&quot;:&quot;long&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":29}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val qc_1_top = qc_1.orderBy(desc(\"count\")).limit(10)","outputs":[{"name":"stdout","output_type":"stream","text":"qc_1_top: org.apache.spark.sql.DataFrame = [quarter: string, count: bigint]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon44ecb3baa23f70d6f0cc07748e40ad32&quot;,&quot;partitionIndexId&quot;:&quot;anonbabd5871c7d8c4259a734d783b04c905&quot;,&quot;numPartitions&quot;:1,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;count&quot;,&quot;type&quot;:&quot;long&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":30}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_1_top.show()","outputs":[{"name":"stdout","output_type":"stream","text":"+--------------+-----+\n|       quarter|count|\n+--------------+-----+\n|  Stadscentrum| 6473|\n|        Hatert| 6388|\n|        Biezen| 4945|\n|Neerbosch-Oost| 4415|\n|          Lent| 4333|\n|     Hengstdal| 3871|\n|      Heseveld| 3559|\n|    Galgenveld| 3510|\n|       Altrade| 3275|\n|     Grootstal| 3079|\n+--------------+-----+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":31}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_1.explain\nprintln\nqc_1_top.explain","outputs":[{"name":"stdout","output_type":"stream","text":"== Physical Plan ==\nInMemoryColumnarTableScan [quarter#45,count#112L], InMemoryRelation [quarter#45,count#112L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#112L]), None\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=10, orderBy=[count#112L DESC], output=[quarter#45,count#112L])\n+- ConvertToSafe\n   +- InMemoryColumnarTableScan [quarter#45,count#112L], InMemoryRelation [quarter#45,count#112L], true, 10000, StorageLevel(true, true, false, true, 1), TungstenAggregate(key=[quarter#45], functions=[(count(1),mode=Final,isDistinct=false)], output=[quarter#45,count#112L]), None\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":32}]},{"metadata":{},"cell_type":"markdown","source":"#### Using SQL"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"addrDF.registerTempTable(\"addresses\")","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":33}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val qc_2_top = sqlContext.sql(\"SELECT quarter, count(quarter) AS qc FROM addresses GROUP BY quarter ORDER BY qc DESC LIMIT 10\")","outputs":[{"name":"stdout","output_type":"stream","text":"qc_2_top: org.apache.spark.sql.DataFrame = [quarter: string, qc: bigint]\n"},{"metadata":{},"data":{"text/html":"<div class=\"df-canvas\">\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon6baaad954d277dd68a6011748b6adbc0&quot;,&quot;partitionIndexId&quot;:&quot;anon699bfc4a9e55792a5e9a69d1debe7ae6&quot;,&quot;numPartitions&quot;:1,&quot;dfSchema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;quarter&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;qc&quot;,&quot;type&quot;:&quot;long&quot;,&quot;nullable&quot;:false,&quot;metadata&quot;:{}}]}}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/dataframe','../javascripts/notebook/consoleDir'], \n      function(dataframe, extension) {\n        dataframe.call(data, this, extension);\n      }\n    );/*]]>*/</script>\n      <link rel=\"stylesheet\" href=\"/assets/stylesheets/ipython/css/dataframe.css\" type=\"text/css\"/>\n    </div>"},"output_type":"execute_result","execution_count":34}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_2_top.show","outputs":[{"name":"stdout","output_type":"stream","text":"+--------------+----+\n|       quarter|  qc|\n+--------------+----+\n|  Stadscentrum|6473|\n|        Hatert|6388|\n|        Biezen|4945|\n|Neerbosch-Oost|4415|\n|          Lent|4333|\n|     Hengstdal|3871|\n|      Heseveld|3559|\n|    Galgenveld|3510|\n|       Altrade|3275|\n|     Grootstal|3079|\n+--------------+----+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":35}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"qc_2_top.explain ","outputs":[{"name":"stdout","output_type":"stream","text":"== Physical Plan ==\nTakeOrderedAndProject(limit=10, orderBy=[qc#198L DESC], output=[quarter#45,qc#198L])\n+- ConvertToSafe\n   +- TungstenAggregate(key=[quarter#45], functions=[(count(quarter#45),mode=Final,isDistinct=false)], output=[quarter#45,qc#198L])\n      +- TungstenExchange hashpartitioning(quarter#45,200), None\n         +- TungstenAggregate(key=[quarter#45], functions=[(count(quarter#45),mode=Partial,isDistinct=false)], output=[quarter#45,count#268L])\n            +- InMemoryColumnarTableScan [quarter#45], InMemoryRelation [street#44,quarter#45,x#46,y#47], true, 10000, StorageLevel(true, true, false, true, 1), ConvertToUnsafe, None\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":36}]},{"metadata":{},"cell_type":"markdown","source":"### Events\n\nNow that we have the address data prepared, move on to look into the data about the events.\n\n[DataBricks](https://databricks.com/company/about-us), the Berkeley spin-off that was founded by the Spark creators, provides a different, tighter integrated CSV parsing library. \n\n\nLet's give that one a try as well; it is available from https://github.com/databricks/spark-csv, and, it is pre-installed on the Spark notebook."},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val ev = sqlContext.read\n    .format(\"com.databricks.spark.csv\")\n    .option(\"header\", \"true\") // Use first line of all files as header\n    .option(\"inferSchema\", \"true\") // Automatically infer data types\n    .load(\"/data/vBoaEvents_all.csv\")","outputs":[{"name":"stdout","output_type":"stream","text":"ev: org.apache.spark.sql.DataFrame = [eventid: int, typeid: int, typenaam: string, statusid: int, statusnaam: string, omschrijving: string, aanvrager: string, bezoekers: string, memorandum: string, website: string, toevoeg: int, wijzig: int]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":37}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"ev.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- typeid: integer (nullable = true)\n |-- typenaam: string (nullable = true)\n |-- statusid: integer (nullable = true)\n |-- statusnaam: string (nullable = true)\n |-- omschrijving: string (nullable = true)\n |-- aanvrager: string (nullable = true)\n |-- bezoekers: string (nullable = true)\n |-- memorandum: string (nullable = true)\n |-- website: string (nullable = true)\n |-- toevoeg: integer (nullable = true)\n |-- wijzig: integer (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":38}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val events = ev.select(\"eventid\",\"typeid\",\"typenaam\",\"statusid\",\"statusnaam\").where(\"typeid = 3 and statusid IN (6,10)\")","outputs":[{"name":"stdout","output_type":"stream","text":"events: org.apache.spark.sql.DataFrame = [eventid: int, typeid: int, typenaam: string, statusid: int, statusnaam: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":39}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"events.explain","outputs":[{"name":"stdout","output_type":"stream","text":"== Physical Plan ==\nFilter ((typeid#270 = 3) && statusid#272 IN (6,10))\n+- Scan CsvRelation(<function0>,Some(/data/vBoaEvents_all.csv),true,,,\",null,#,PERMISSIVE,COMMONS,false,false,false,null,true,null)[eventid#269,typeid#270,typenaam#271,statusid#272,statusnaam#273] PushedFilters: [EqualTo(typeid,3), In(statusid,[Ljava.lang.Object;@37084695)]\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":40}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val evl = sqlContext.read\n    .format(\"com.databricks.spark.csv\")\n    .option(\"header\", \"true\") // Use first line of all files as header\n    .option(\"inferSchema\", \"true\") // Automatically infer data types\n    .load(\"/data/vBoaEventsLoc_all.csv\")","outputs":[{"name":"stdout","output_type":"stream","text":"evl: org.apache.spark.sql.DataFrame = [eventid: int, locatieid: int, evenementenlocatie: int, straat: string, plaats: string, x_koord: string, y_koord: string, statusid: int, statusnaam: string, eerste: int, eerstetijd: int, laatste: int, laatstetijd: int, eersteevent: int, laatsteevent: int, memorandum: string, toevoeg: int, wijzig: int]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":41}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evl.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- locatieid: integer (nullable = true)\n |-- evenementenlocatie: integer (nullable = true)\n |-- straat: string (nullable = true)\n |-- plaats: string (nullable = true)\n |-- x_koord: string (nullable = true)\n |-- y_koord: string (nullable = true)\n |-- statusid: integer (nullable = true)\n |-- statusnaam: string (nullable = true)\n |-- eerste: integer (nullable = true)\n |-- eerstetijd: integer (nullable = true)\n |-- laatste: integer (nullable = true)\n |-- laatstetijd: integer (nullable = true)\n |-- eersteevent: integer (nullable = true)\n |-- laatsteevent: integer (nullable = true)\n |-- memorandum: string (nullable = true)\n |-- toevoeg: integer (nullable = true)\n |-- wijzig: integer (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":42}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val evloc = evl.select(\"eventid\", \"straat\", \"x_koord\", \"y_koord\")","outputs":[{"name":"stdout","output_type":"stream","text":"evloc: org.apache.spark.sql.DataFrame = [eventid: int, straat: string, x_koord: string, y_koord: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":43}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evloc.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- eventid: integer (nullable = true)\n |-- straat: string (nullable = true)\n |-- x_koord: string (nullable = true)\n |-- y_koord: string (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":44}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"// UGLY: this string transform needs to be replaced by proper Locale handling...\nimport org.apache.spark.sql.functions._\nval evlxy = evloc\n  .withColumn(\"x_koord\", translate(evloc.col(\"x_koord\"),\",\",\".\").cast(\"float\"))\n  .withColumn(\"y_koord\", translate(evloc.col(\"y_koord\"),\",\",\".\").cast(\"float\"))","outputs":[{"name":"stdout","output_type":"stream","text":"import org.apache.spark.sql.functions._\nevlxy: org.apache.spark.sql.DataFrame = [eventid: int, straat: string, x_koord: float, y_koord: float]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":45}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evlxy.filter(\"eventid = 2250\").show()","outputs":[{"name":"stdout","output_type":"stream","text":"+-------+-----------------+---------+---------+\n|eventid|           straat|  x_koord|  y_koord|\n+-------+-----------------+---------+---------+\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n|   2250|St stevenskerkhof|187714.69|428928.28|\n+-------+-----------------+---------+---------+\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":46}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"events.registerTempTable(\"events\")","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":47}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"evlxy.registerTempTable(\"eventloc\")","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":49}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"","outputs":[{"ename":"Error","output_type":"error","traceback":["Incomplete (hint: check the parenthesis)"]}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val el = sqlContext.sql(\n  \"SELECT e1.eventid e, straat a, x_koord x,y_koord y \" +\n  \"FROM events e1, eventloc e2 \" +\n  \"WHERE e1.eventid = e2.eventid\"\n)","outputs":[{"name":"stdout","output_type":"stream","text":"el: org.apache.spark.sql.DataFrame = [e: int, a: string, x: float, y: float]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":50}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"el.show()","outputs":[{"name":"stdout","output_type":"stream","text":"+----+--------------------+---------+---------+\n|   e|                   a|        x|        y|\n+----+--------------------+---------+---------+\n|2235|            floraweg|186310.31| 427677.2|\n|2236|        rivierstraat|186198.45| 429181.2|\n|2044|          Mari?nburg|188048.81| 428621.5|\n|2245|       Stationsplein| 187133.4| 428390.7|\n|2245|          houtstraat|187691.05|428823.62|\n|2245|  van welderenstraat|187800.62| 428391.3|\n|2245|          Mari?nburg|187972.64|428627.62|\n|2245|          Mari?nburg|188048.81| 428621.5|\n|2245|            Waalkade| 188140.2|429062.97|\n|2245|          Plein 1944|187764.98|428698.16|\n|2245|         Kelfkensbos| 188271.7|428786.38|\n|2245|van schaeck matho...|187283.84|428282.28|\n|2245|    tweede walstraat|187849.64| 428445.8|\n|2245|        Ganzenheuvel|187665.56|428910.62|\n|2245|       marikenstraat| 188022.1|428704.12|\n|2245|         waalbandijk|186947.05| 429105.6|\n|2245|   lange hezelstraat| 187484.9| 428946.5|\n|2047|              Wedren|188016.73| 428163.4|\n|2048|     Centrum straten| 187813.9|428865.72|\n|2248|         Grote Markt|187838.75|428880.16|\n+----+--------------------+---------+---------+\nonly showing top 20 rows\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":51}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"el.registerTempTable(\"el\")","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":52}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"el.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- e: integer (nullable = true)\n |-- a: string (nullable = true)\n |-- x: float (nullable = true)\n |-- y: float (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":53}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val t = sqlContext.sql(\n  \"SELECT DISTINCT e, a, quarter as w \" + \n  \"FROM el, addresses aa \" +\n  \"WHERE (abs(el.x - aa.x) < 25) and (abs(el.y - aa.y) < 25) \")","outputs":[{"name":"stdout","output_type":"stream","text":"t: org.apache.spark.sql.DataFrame = [e: int, a: string, w: string]\n"},{"metadata":{},"data":{"text/html":"<span style=\"color:red;\">Ooops, exception in the cell: </span>"},"output_type":"execute_result","execution_count":99}]},{"metadata":{"trusted":true,"input_collapsed":false,"output_stream_collapsed":true,"collapsed":false},"cell_type":"code","source":"t.count","outputs":[{"name":"stdout","output_type":"stream","text":"res57: Long = 44\n"},{"metadata":{},"data":{"text/html":"44"},"output_type":"execute_result","execution_count":100}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"t.show","outputs":[{"name":"stdout","output_type":"stream","text":"+----+--------------------+------------+\n|   e|                   a|           w|\n+----+--------------------+------------+\n|2245|          Mari?nburg|Stadscentrum|\n|2251|        Ganzenheuvel| Benedenstad|\n|2245|        Ganzenheuvel|Stadscentrum|\n|1967|          Mari?nburg|Stadscentrum|\n|2245|          houtstraat|Stadscentrum|\n|2245|       marikenstraat|Stadscentrum|\n|2251|          lage markt| Benedenstad|\n|2251|        Ganzenheuvel|Stadscentrum|\n|2273| Irene Vorrinkstraat|      Hatert|\n|2044|          Mari?nburg|Stadscentrum|\n|1938|      groesbeekseweg|  Galgenveld|\n|1960|          Mari?nburg|Stadscentrum|\n|2245|         Kelfkensbos|Stadscentrum|\n|1938|van schaeck matho...|Stadscentrum|\n|2245|   lange hezelstraat| Benedenstad|\n|2251|          oude haven| Benedenstad|\n|2048|     Centrum straten| Benedenstad|\n|2245|   lange hezelstraat|Stadscentrum|\n|2245|    tweede walstraat|Stadscentrum|\n|1960|         Kelfkensbos|Stadscentrum|\n+----+--------------------+------------+\nonly showing top 20 rows\n\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":101}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"","outputs":[]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"sqlContext.sql(\"SELECT DISTINCT e FROM el\").count","outputs":[{"name":"stdout","output_type":"stream","text":"res53: Long = 51\n"},{"metadata":{},"data":{"text/html":"51"},"output_type":"execute_result","execution_count":95}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val t = sqlContext.sql(\n  \"SELECT e, el.x - aa.x as dx, el.y - aa.y as dy, a, quarter as w \" + \n  \"FROM el, addresses aa \" +\n  \"WHERE (abs(el.x - aa.x) < 10) and (abs(el.y - aa.y) < 10) \")","outputs":[{"ename":"Error","output_type":"error","traceback":["Incomplete (hint: check the parenthesis)"]}]}],"nbformat":4}